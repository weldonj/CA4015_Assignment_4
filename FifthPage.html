
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Setup &#8212; CA4015 Assignment 4 - Recommender System for Last.fm users - Daniel O&#39;Boyle, Liam Carroll, John Weldon</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Summary" href="Summary_Conclusion.html" />
    <link rel="prev" title="T-distributed Stochastic Neighbor Embedding" href="FourthPage.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/simps.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">CA4015 Assignment 4 - Recommender System for Last.fm users - Daniel O'Boyle, Liam Carroll, John Weldon</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Intro_and_Desc_of_Data.html">
   BACKGROUND AND APPROACHES
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Data Preparation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="FirstPage.html">
   Setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="FirstPage.html#loading-data">
   Loading Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="FirstPage.html#data-exploration">
   Data Exploration
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Matrix Factorization Model
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html">
   Import everything we need
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#mount-drive">
   Mount Drive
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#section-ii-preliminaries">
   Section II - Preliminaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#build-sparse-tensor">
   Build Sparse Tensor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#mean-square-error">
   Mean Square Error
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#section-iii-training-factorization-model">
   Section III - Training Factorization Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#building-the-model">
   Building the Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#build-and-train-the-collaborative-filtering-model">
   Build and train the Collaborative Filtering Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#section-iv-inspect-embeddings">
   Section IV - Inspect Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SecondPage.html#section-v-regularization-in-matrix-factorization">
   Section V - Regularization in Matrix Factorization
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Spotify Integration
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="ThirdPage.html">
   Spotify Web API Integration with Tekore
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  TSNE Clustering
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="FourthPage.html">
   T-distributed Stochastic Neighbor Embedding
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Graph Analysis
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#load-data">
   Load Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#constructing-user-graph">
   Constructing User Graph
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#centrality-analysis">
   Centrality Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#community-detection">
   Community Detection
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Concluding Section
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Summary_Conclusion.html">
   Summary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Summary_Conclusion.html#learning-outcomes">
   Learning Outcomes
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/FifthPage.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/FifthPage.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-data">
   Load Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#constructing-user-graph">
   Constructing User Graph
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#building-graph">
     Building graph
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inserting-nodes-and-relationships">
     Inserting nodes and relationships
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#graph-visualisation">
     Graph visualisation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#centrality-analysis">
   Centrality Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#degree-centrality">
     Degree Centrality
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#betweeness-centrality">
     Betweeness Centrality
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#community-detection">
   Community Detection
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clauset-newman-moore-greedy-modularity-maximization">
     Clauset-Newman-Moore Greedy Modularity Maximization
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install neo4j
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting neo4j
?25l  Downloading https://files.pythonhosted.org/packages/36/f7/3c0b20ad7cdeac89d44e5380b0b4507995b1aec843692e3e76dd6cd1c638/neo4j-4.2.1.tar.gz (69kB)

     |████▊                           | 10kB 14.8MB/s eta 0:00:01
     |█████████▍                      | 20kB 19.6MB/s eta 0:00:01
     |██████████████▏                 | 30kB 9.5MB/s eta 0:00:01
     |██████████████████▉             | 40kB 8.3MB/s eta 0:00:01
     |███████████████████████▋        | 51kB 4.4MB/s eta 0:00:01
     |████████████████████████████▎   | 61kB 4.8MB/s eta 0:00:01
     |████████████████████████████████| 71kB 2.7MB/s 
?25hRequirement already satisfied: pytz in /usr/local/lib/python3.6/dist-packages (from neo4j) (2018.9)
Building wheels for collected packages: neo4j
  Building wheel for neo4j (setup.py) ... ?25l?25hdone
  Created wheel for neo4j: filename=neo4j-4.2.1-cp36-none-any.whl size=95190 sha256=06c31a03538da8b01d77d1d9f488e19414ab1a2142678faa0b6f351087287ece
  Stored in directory: /root/.cache/pip/wheels/00/a8/69/083e04c2ffc0a7e026c9356cd5bb54c65128f3e08ef8371be0
Successfully built neo4j
Installing collected packages: neo4j
Successfully installed neo4j-4.2.1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mounted at /content/drive
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/content/drive/My Drive/College - 4th Year/CA4015_AdvancedML/Assignment_4&#39;</span><span class="p">)</span> <span class="c1"># Liam</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-data">
<h1>Load Data<a class="headerlink" href="#load-data" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_friends</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/last.fm/user_friends.dat&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">utag_artists</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/last.fm/user_taggedartists.dat&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">user_artists</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/last.fm/user_artists.dat&quot;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_friends</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userID</th>
      <th>friendID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>275</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>428</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>515</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>761</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>831</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="constructing-user-graph">
<h1>Constructing User Graph<a class="headerlink" href="#constructing-user-graph" title="Permalink to this headline">¶</a></h1>
<p>The first step in building a graph model of the user network for this dataset is to build the different nodes and relationships which exist in the graph. Firstly, nodes for each of the users would need to constructed. Without the presence of a <em>user</em>, we need to extract the unique user ids from the various tables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">users1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_friends</span><span class="p">[</span><span class="s2">&quot;userID&quot;</span><span class="p">])</span>
<span class="n">users2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">utag_artists</span><span class="p">[</span><span class="s2">&quot;userID&quot;</span><span class="p">])</span>
<span class="n">users3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_artists</span><span class="p">[</span><span class="s2">&quot;userID&quot;</span><span class="p">])</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">users1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">users2</span><span class="p">,</span> <span class="n">users3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1892
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_user</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>
<span class="n">df_user</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;userID&quot;</span><span class="p">]</span>
<span class="n">df_user</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="building-graph">
<h2>Building graph<a class="headerlink" href="#building-graph" title="Permalink to this headline">¶</a></h2>
<p>Building graph database of user network…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="inserting-nodes-and-relationships">
<h2>Inserting nodes and relationships<a class="headerlink" href="#inserting-nodes-and-relationships" title="Permalink to this headline">¶</a></h2>
<p>Adding user nodes…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Adding the 12k friendships from the <em>user_friends</em> table…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">user_friends</span><span class="p">[</span><span class="s2">&quot;userID&quot;</span><span class="p">],</span> <span class="n">user_friends</span><span class="p">[</span><span class="s2">&quot;friendID&quot;</span><span class="p">]):</span>
  <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">*</span><span class="n">rel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Checking that we’ve constructed the graph correctly…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1892
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12717
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="graph-visualisation">
<h2>Graph visualisation<a class="headerlink" href="#graph-visualisation" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/FifthPage_25_0.png" src="_images/FifthPage_25_0.png" />
</div>
</div>
<p>Due to the dense structure of the nodes in the centre of the graph, the different users cannot really be distinguished from this. However, we can see the many smaller communities which exist among the graph and the larger communtiy which also exists.</p>
</div>
</div>
<div class="section" id="centrality-analysis">
<h1>Centrality Analysis<a class="headerlink" href="#centrality-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="degree-centrality">
<h2>Degree Centrality<a class="headerlink" href="#degree-centrality" title="Permalink to this headline">¶</a></h2>
<p>We will explore the aforementioned communities later. Firstly, we are going to carry out some centrality analysis on the graph. Centrality algorithms identify the most important nodes within a graph.

The most simple centrality algorithm is degree centrality, which counts the number of in-links and out-links which a given node has. As our graph is undirected, degree centrality simply represents the number of friendships a certain user node has. The value itself is the fraction of the other nodes which the node is connected to.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deg_cent</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">deg_cent</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="s2">&quot;User ID: &quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;Degree Centrality: &quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;Degree: &quot;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1. User ID:  1543 | Degree Centrality:  0.06292966684294024 | Degree:  119
2. User ID:  1281 | Degree Centrality:  0.05817028027498678 | Degree:  110
3. User ID:  831 | Degree Centrality:  0.05605499735589635 | Degree:  106
4. User ID:  179 | Degree Centrality:  0.05129561078794289 | Degree:  97
5. User ID:  1503 | Degree Centrality:  0.05023796932839767 | Degree:  95
6. User ID:  1023 | Degree Centrality:  0.048122686409307246 | Degree:  91
7. User ID:  405 | Degree Centrality:  0.047593865679534636 | Degree:  90
8. User ID:  1895 | Degree Centrality:  0.047593865679534636 | Degree:  90
9. User ID:  1300 | Degree Centrality:  0.04706504494976203 | Degree:  89
10. User ID:  390 | Degree Centrality:  0.046536224219989424 | Degree:  88
</pre></div>
</div>
</div>
</div>
<p>The top 10 users based on their amount of friendships is shown above. The top user is friends with 119 other users!</p>
</div>
<div class="section" id="betweeness-centrality">
<h2>Betweeness Centrality<a class="headerlink" href="#betweeness-centrality" title="Permalink to this headline">¶</a></h2>
<p>Betweeness is antoher centrality measure for nodes within a graph. Betweeness centrality quantifies the number of times a particular node acts as a bridge along the shortest path between two other nodes. In other words, it highlights <em>bridge nodes</em> in a graph.

For instance, within our user graph, if a node existed which provided a link between a number of smaller communities of users and a bigger community of users, it would have high betweeness centrality. It will be interesting to see if the user who is friends with the most users also has the highest betweeness score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bet_cent</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">betweenness_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">bet_cent</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="s2">&quot;User ID: &quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;Betweeness Centrality: &quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span>  <span class="s2">&quot;Degree: &quot;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1. User ID:  1543 | Betweeness Centrality:  0.06652735710530977 | Degree:  119
2. User ID:  1281 | Betweeness Centrality:  0.05454857830063434 | Degree:  110
3. User ID:  831 | Betweeness Centrality:  0.0486909627192555 | Degree:  106
4. User ID:  1258 | Betweeness Centrality:  0.043025085275128785 | Degree:  86
5. User ID:  78 | Betweeness Centrality:  0.02933678308141875 | Degree:  81
6. User ID:  1213 | Betweeness Centrality:  0.02416713291715056 | Degree:  68
7. User ID:  1130 | Betweeness Centrality:  0.02379941702234762 | Degree:  57
8. User ID:  1503 | Betweeness Centrality:  0.023197150480945353 | Degree:  95
9. User ID:  298 | Betweeness Centrality:  0.02311287444872993 | Degree:  79
10. User ID:  1597 | Betweeness Centrality:  0.02175259253890188 | Degree:  70
</pre></div>
</div>
</div>
</div>
<p>The three users who had the highest number of friendships also have the highest betweeness centrality scores. This underscores the diversity of the friendships which they have but also may be an artefact of the little information which we have about the users.

User 1130 must have friendships with users from a vast array of sub-communities given his high betweeness score and low amount of friendships compared to the other top scorers.</p>
</div>
</div>
<div class="section" id="community-detection">
<h1>Community Detection<a class="headerlink" href="#community-detection" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">networkx.algorithms</span> <span class="kn">import</span> <span class="n">community</span>
</pre></div>
</div>
</div>
</div>
<p>Communities of node are said to be nodes which are densely connected internally. From the plot of our graph, we can see that there are a number of naturally occuring sub-communities which exist across our graph. We explore these communities below.</p>
<p>Below a dictionary of colors is defined for use in plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span> <span class="k">as</span> <span class="n">mcolors</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">colors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">BASE_COLORS</span><span class="p">,</span> <span class="o">**</span><span class="n">mcolors</span><span class="o">.</span><span class="n">CSS4_COLORS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="clauset-newman-moore-greedy-modularity-maximization">
<h2>Clauset-Newman-Moore Greedy Modularity Maximization<a class="headerlink" href="#clauset-newman-moore-greedy-modularity-maximization" title="Permalink to this headline">¶</a></h2>
<p>Greedy modularity maximization begins with each node in its own community and joins the pair of communities that most increases modularity until no such pair exists. Several sets of nodes are returned representing the different communities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cnm_gmm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">community</span><span class="o">.</span><span class="n">greedy_modularity_communities</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">cnm_gmm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>42
</pre></div>
</div>
</div>
</div>
<p>There are 42 sub-communities present in our user community! Below, we create nodelists for each community for the sake of visualisation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cnm_gmm_nodelists</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">cnm_gmm</span><span class="p">:</span>
  <span class="n">cnm_gmm_nodelists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">comm</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Visualising the communities…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>

<span class="c1">#list of edges</span>
<span class="n">elist</span> <span class="o">=</span> <span class="p">[</span><span class="n">rel</span> <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">user_friends</span><span class="p">[</span><span class="s2">&quot;userID&quot;</span><span class="p">],</span> <span class="n">user_friends</span><span class="p">[</span><span class="s2">&quot;friendID&quot;</span><span class="p">])]</span>

<span class="c1">#create the networkx Graph with node types and specifying edge distances</span>
<span class="n">GC1</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">:</span>
    <span class="n">GC1</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="k">for</span> <span class="n">from_loc</span><span class="p">,</span> <span class="n">to_loc</span> <span class="ow">in</span> <span class="n">elist</span><span class="p">:</span>
    <span class="n">GC1</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">from_loc</span><span class="p">,</span> <span class="n">to_loc</span><span class="p">)</span>   

<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">GC1</span><span class="p">)</span> <span class="c1">#calculate position for each node</span>
<span class="c1"># pos is needed because we are going to draw a few nodes at a time,</span>
<span class="c1"># pos fixes their positions.</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>

<span class="c1"># Draw the graph, but don&#39;t color the nodes</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">GC1</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>  <span class="n">with_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">font_weight</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span> <span class="mi">70</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>

<span class="c1">#For each community list, draw the nodes, giving it a specific color</span>
<span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">cnm_gmm_nodelists</span><span class="p">:</span>
  <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">GC1</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">comm</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/FifthPage_50_0.png" src="_images/FifthPage_50_0.png" />
</div>
</div>
<p>From the plot, we can see the different communities which exists throughout the user dataset. The smaller communities made up of only a few nodes can be see dotted around the edge of the graph.

It’s clear that one bigger community exists in the user network but in this community, there are also smaller cliques of users dotted throughout!</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="FourthPage.html" title="previous page">T-distributed Stochastic Neighbor Embedding</a>
    <a class='right-next' id="next-link" href="Summary_Conclusion.html" title="next page">Summary</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>